# 要件定義書（mictylish）
## 1. 目的
既存シェルで起きやすい事故（クォート漏れ、単語分割、暗黙展開、曖昧なエラー処理）を、言語仕様と実行モデルで構造的に防ぐ。
同時に、パイプ中心の操作体験を維持し、型付きデータフローで安全に自動化できるシェルを実装する。
## 2. コンセプト
- すべてをストリーム（データフロー）として扱う
- 行テキストではなく値（Value）やレコード（Row）を流す
- 失敗は例外ではなく Result 値で扱う
- 副作用は `io do ... end` 境界に閉じ込める
- 暗黙展開を禁止し、必要な展開は明示 API で実行する
- 再束縛・シャドウイングを禁止する
## 3. 対象ユーザー
- 日常の開発自動化を安全に書きたい開発者
- CI・運用スクリプトで事故を減らしたいチーム
## 4. 非目標（初期）
- Bash 完全互換（文法・挙動の再現）
- 高度な静的型推論の完成
- 高度ジョブ制御の完全実装
## 5. 機能要件（MUST）
### 5.1 言語
- パイプ演算子 `|>`
- 無名関数 `fn ... -> ... end`
- `match ... do ... end` と `when` ガード
- `with pat <- expr, ... do ... else ... end`
- `io do ... end` による副作用境界
- `let` / `let mut` / `set`（再束縛禁止）
- 暗黙 glob・単語分割の禁止
### 5.2 データモデル
- `Value`（Null/Bool/Int/Float/String/Bytes/List/Record ほか）
- `Result`（Ok/Err）
- 構造化 `Error`（kind/span/cmd/args/stderr/code など）
### 5.3 実行モデル
- パイプは `Stream<Value/Row>` 合成として実行
- 外部コマンドは「プログラム名 + 引数配列」で安全実行
- 失敗は Result として伝播し、握りつぶしは明示的に行う
## 6. 非機能要件（MUST）
- span 付き診断を返す
- 名前解決時にシャドウイング禁止を静的検査
- 引数境界を壊さないプロセス起動
## 7. 受け入れ基準
- `"a b"` を引数に渡しても意図せず分割されない
- `glob(...)` を呼ばない限り `*` は展開されない
- `let x = 1` の後に `let x = 2` はエラー
- `Ok(x)` の束縛が外側 `x` と衝突したらエラー
- 危険操作は `io do ... end` 外で実行できない
